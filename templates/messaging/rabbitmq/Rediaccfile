#!/bin/bash

prep() {
    echo "Pulling RabbitMQ image..."
    docker pull rabbitmq:3-management-alpine
    
    echo "Creating data directory..."
    mkdir -p ./data
    chmod 755 ./data
    
    return $?
}

up() {
    if [ -f .env ]; then
        source .env
    fi
    
    echo "Starting RabbitMQ server..."
    docker compose up -d
    
    echo "Waiting for RabbitMQ to be ready..."
    sleep 15
    
    echo "RabbitMQ is running on port ${RABBITMQ_PORT:-5672}"
    echo "Management UI is available at http://localhost:${RABBITMQ_MANAGEMENT_PORT:-15672}"
    echo "Default credentials: ${RABBITMQ_DEFAULT_USER:-admin} / ${RABBITMQ_DEFAULT_PASS:-adminPassword123!}"
    
    return $?
}

down() {
    echo "Stopping RabbitMQ server..."
    docker compose down -v
    return $?
}

