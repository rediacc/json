#!/bin/bash

prep() {
    echo "Pulling Keycloak and PostgreSQL images..."
    docker pull quay.io/keycloak/keycloak:latest
    docker pull postgres:15-alpine
    
    echo "Creating data directory..."
    mkdir -p ./data
    chmod 755 ./data
    
    return $?
}

up() {
    if [ -f .env ]; then
        source .env
    fi
    
    echo "Starting Keycloak with PostgreSQL..."
    docker compose up -d
    
    echo "Waiting for Keycloak to start..."
    sleep 20
    
    echo "Keycloak is starting..."
    echo "Admin Console: http://localhost:${KEYCLOAK_PORT:-8080}/admin"
    echo "Admin Username: ${KEYCLOAK_ADMIN:-admin}"
    echo "Admin Password: ${KEYCLOAK_ADMIN_PASSWORD:-admin}"
    
    return $?
}

down() {
    echo "Stopping Keycloak..."
    docker compose down -v
    return $?
}

"$@"