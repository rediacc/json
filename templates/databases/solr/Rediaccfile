#!/bin/bash

prep() {
    echo "Pulling Apache Solr image..."
    docker pull solr:9-slim

    echo "Creating data directory..."
    mkdir -p ./data

    # Solr runs as user 8983:8983 inside the container
    # Set appropriate permissions for the data directory
    sudo chown -R 8983:8983 ./data 2>/dev/null || chown -R 8983:8983 ./data 2>/dev/null || chmod 777 ./data

    return $?
}

up() {
    if [ -f .env ]; then
        source .env
    fi

    echo "Starting Apache Solr server..."
    docker compose up -d

    echo "Waiting for Solr to be ready..."
    sleep 5

    echo ""
    echo "Solr is starting up..."
    echo "Admin UI will be available at: http://localhost:\$(docker port ${CONTAINER_NAME:-solr-server} 8983 | cut -d: -f2)/solr"
    echo "Core '${SOLR_CORE_NAME:-mycore}' is being created..."

    return $?
}

down() {
    echo "Stopping Apache Solr server..."
    docker compose down -v
    return $?
}

"$@"
