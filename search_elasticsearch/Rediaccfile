#!/bin/bash

prep() {
    echo "Pulling Elasticsearch and Kibana images..."
    docker pull elasticsearch:8.11.0
    docker pull kibana:8.11.0
    
    echo "Creating data directory..."
    mkdir -p ./data
    chmod 755 ./data
    
    return $?
}

up() {
    if [ -f .env ]; then
        source .env
    fi
    
    echo "Starting Elasticsearch cluster..."
    docker compose up -d
    
    echo "Waiting for Elasticsearch to be ready..."
    sleep 30
    
    echo "Elasticsearch is running on port ${ES_PORT:-9200}"
    echo "Kibana is available at http://localhost:${KIBANA_PORT:-5601}"
    
    return $?
}

down() {
    echo "Stopping Elasticsearch cluster..."
    docker compose down
    return $?
}

"$@"